<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Одоо гарч буй кино</title>
        <meta http-equiv='X-UA-Compatible' content='IE=edge'>
        <meta name='viewport' content='width=device-width, initial-scale=1'>
        <meta name="description" content="Одоо гарч буй кинонууд, дэлгэцнээ гарч буй кино, кино үзэх">
        <link rel="stylesheet" href="css/nowplaying.css">
        <link rel="stylesheet" href="css/style.css"/>
        <script type="module" src="json2.js" defer></script>
        <script>
            class movie{
                constructor(){
                }
                List(){
                    const mov = [
                                    {
                                        name: "Suzume",
                                        img: "Images/nowplaying_poster1.png",
                                        imdb: 7.7,
                                        rtr: "96%",
                                        category: "Animation",
                                    },
                                    {
                                        name: "Elemental",
                                        img: "Images/nowplaying_poster2.png",
                                        imdb: "7.0",
                                        rtr: "74%",
                                        category: "Rom-Com",
                                    },
                                    {
                                        name: "The NUN",
                                        img: "Images/nowplaying_poster3.png",
                                        imdb: 5.8,
                                        rtr: "52%",
                                        category: "Horror",
                                    },
                                    {
                                        name: "Будилаан",
                                        img: "Images/nowplaying_poster4.png",
                                        imdb: "NR",
                                        rtr: "NR",
                                        category: "Adventure",
                                    },
                                    {
                                        name: "The Creator",
                                        img: "Images/comingsoon_poster1.png",
                                        imdb: 7.2,
                                        rtr: "67%",
                                        category: "Action",
                                    },
                                    {
                                        name: "Paw Patrol",
                                        img: "Images/comingsoon_poster2.png",
                                        imdb: 6.1,
                                        rtr: "84%",
                                        category: "Animation",
                                    },
                                    {
                                        name: "Cobweb",
                                        img: "Images/comingsoon_poster3.png",
                                        imdb: 5.9,
                                        rtr: "59%",
                                        category: "Horror",
                                    },
                                    {
                                        name: "Saw X",
                                        img: "Images/comingsoon_poster4.png",
                                        imdb: 7.2,
                                        rtr: "83%",
                                        category: "Horror",
                                    },
                                    {
                                        name: "The Exorcist",
                                        img: "Images/comingsoon_poster5.png",
                                        imdb: 7.1,
                                        rtr: "96%",
                                        category: "Horror",
                                    },
                    ]; 
                    const p = mov;
                        let data = `
                        <h2 style="color: var(--color-white);
                        padding: 2rem;
                        margin-bottom: 4rem;
                        ">МАНАЙ ДЭЛГЭЦНЭЭ</h2>
                        <section>`;
                    for( const product of p){
                        const prod=new Product(product);
                        data += prod.Render();
                    }
                    data+="</section>";
                    
                    document.getElementById("app").insertAdjacentHTML("beforeend", data);
                }
            }
            class Product {
            constructor(product) {
                this.name = product.name;
                this.img = product.img;
                this.imdb = product.imdb;
                this.rtr = product.rtr;
                this.category=product.category;
            }
            
            Render(){
                return `
                <article>
                <a href="movie.html" class="movie_poster">
                    <img src="${this.img}" alt="poster">${this.name}
                </a>
                <div class="rating">
                    <a href="https://www.imdb.com/title/tt16428256/?ref_=nv_sr_srsg_3_tt_4_nm_4_q_Suzu">
                        <img src="Images/imdb_icon.png"  alt="imdb rating" >${this.imdb}
                    </a>
                    <a href="https://www.rottentomatoes.com/m/suzume">
                        <img src="Images/rotten_tomatos_icon.png"  alt="rotten tomato rating" >${this.rtr}
                    </a>
                </div>
            </article>`
            }
        }

        async function fetchData() {
            const response = await fetch('your_server_endpoint'); 
            const data = await response.json();
            return data;
        }
        
        function filterMovies(data, category) {
            return data.filter(movie => movie.category === category);
        }
        
        function renderMovies(movies) {
            const movieSection = document.querySelector('main section');
            movieSection.innerHTML = ''; 
        
            movies.forEach(movie => {
            const article = document.createElement('article');
            article.innerHTML = `
                <a href="movie.html" class="movie_poster">
                <img src="${movie.poster}" alt="${movie.title} poster">${movie.title}
                </a>
                <div class="rating">
                <a href="${movie.imdbLink}">
                    <img src="Images/imdb_icon.png" alt="imdb rating">${movie.imdbRating}
                </a>
                <a href="${movie.rottenTomatoesLink}">
                    <img src="Images/rotten_tomatos_icon.png" alt="rotten tomato rating">${movie.rottenTomatoesRating}
                </a>
                </div>
            `;
        
            movieSection.appendChild(article);
            });
        }
        
        async function onPageLoad() {
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category');
        
            const data = await fetchData();
        
            if (category) {
            const filteredMovies = filterMovies(data, category);
            renderMovies(filteredMovies);
            } else {
            renderMovies(data);
            }
        }
        
        document.addEventListener('DOMContentLoaded', onPageLoad);

        async function onPageLoad() {
            const urlParams = new URLSearchParams(window.location.search);
            const category = urlParams.get('category');
        
            const data = await fetchData();
        
            if (category) {
            const filteredMovies = filterMovies(data, category);
            renderMovies(filteredMovies);
        

            const categoryLinks = document.querySelectorAll('#category-links a');
            categoryLinks.forEach(link => {
                const linkCategory = link.getAttribute('href').split('=')[1];
                if (linkCategory === category) {
                link.classList.add('active');
                } else {
                link.classList.remove('active');
                }
            });
            } else {
            renderMovies(data);
            }
        }
        </script>
    </head>
    <body>
        <header>
            <nav>
                <address>
                    <ul id="address_icon">
                        <li><a href="https://www.facebook.com/PrimeCineplexMongolia"><img src="Images/header_fb_icon.png" alt="facebook icon"></a></li>
                        <li><a href="https://www.instagram.com/primecineplex_mongolia/"><img src="Images/header_ig_icon.png"  alt="instagram icon"></a></li>
                        <li><a href="https://www.youtube.com/@primecineplexmongolia3406"><img src="Images/header_yt_icon.png"  alt="youtube icon"></a></li>
                        <li><a href="mailto:info@primecineplex.mn"><img src="Images/footer_mail-icon.png" alt="mail icon"></a></li>
                    </ul>
                </address>
            </nav>
            <nav>
                <a href="index.html"><img src="Images/logo.jpg" id="logo" alt="primeLogo"></a>
                <ul id="menu">
                    <li><a href="nowplaying.html">КИНО</a></li>
                    <li><a href="aboutus.html">ЗӨВХӨН МАНАЙД</a></li>
                    <li><a href="aboutus.html">ҮЙЛЧИЛГЭЭ</a></li>
                    <li><a href="aboutus.html">БИДНИЙ ТУХАЙ</a></li>
                    <li><a id="login" href="login.html">НЭВТРЭХ</a></li>
                </ul>
            </nav>
        </header>
        <main id="app">
    
        </main>
        <footer>
            <div id="address_info">
                 <address>
                 <ul>
                     <li>
                         <img src="Images/footer_location-icon.png" alt="location icon">
                         <p>Монгол улс, Улаанбаатар хот, <br>
                             Хан-Уул дүүрэг 11-р хороо, <br>
                             Дүнжингаравын гудамж, <br>
                             Зайсан Хилл Цогцолбор, 1-р давхар</p>
                     </li>
                     <li>
                         <img src="Images/footer_mail-icon.png" alt="mail icon">
                         <a href="mailto:info@primecineplex.mn">@primecineplex.mn</a>
                     </li>
                     <li>
                         <img src="Images/footer_phone-icon.png"  alt="phone icon">
                         <a href="tel:+976-7510-0000">+976-7510-0000</a>
                     </li>
                 </ul>
                 </address>
            </div>
            <div id="map">
                <div class="location">
                    <p>Зайсан Хилл Комплекс</p>
                    <p><a href="https://www.google.com/maps"><img src="Images/footer_googlemap.png" alt="google map photo"></a></p>
                </div>
                <div class="location">
                    <p>Энканто товер</p>
                    <p><a href="https://www.google.com/maps"><img src="Images/footer_googlemap.png" alt="google map photo"></a></p>
                </div>
                <div class="location">
                    <p>Ботаник центер</p>
                    <p><a href="https://www.google.com/maps"><img src="Images/footer_googlemap.png" alt="google map photo"></a></p>
                </div>
            </div>    
         </footer>
    </body>

    <script>
        var app = new movie();
        app.List();
    </script>
</html>